<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  </head>
  <body>
  	<div id="containter">
        <div id="loginPanel">
        	<h2><span class="fontawesome-lock"><i class="fa fa-child fa-lg"></i></span>Play4Life</h2>
        	<form action="" id="login">
                <fieldset>
                	<div id="logo"></div>
                	<p style="display:none"><label for="name">Name:</label></p>
              		<p><input type="text" id="name" name="name" value="nickname" onBlur="if(this.value=='')this.value='nickname'" onFocus="if(this.value=='nickname')this.value=''" /></p>
                    <p style="display:none"><label for="email">E-mail</label></p>
                    <p><input type="email" id="email" name="email" value="e-mail address" onBlur="if(this.value=='')this.value='e-mail address'" onFocus="if(this.value=='e-mail address')this.value=''" /></p> <!-- JS because of IE support; better: placeholder="mail@address.com" -->
                    <p><input type="submit" class="disabled" value="enter"></p>
                    <p><div id="anonymous">or <a href="#" id="anonymous">enter anonymously</a></div></p>
                </fieldset>
			</form>
        </div>
        <div id="chatPanel">
            <ul id="messages"></ul>
            <form action="" id="chat">
              <input type="text" id="m" autocomplete="off" value="chat" onBlur="if(this.value=='')this.value='chat'" onFocus="if(this.value=='chat')this.value=''" />
              <input type="submit" value="send" />
            </form>
        </div>
    </div>
    <script>
      var username = "";
	  var email = "";
	  var fieldCompleted = false;
      var socket = io.connect('/client');
	  $('#name').change(function(e) {
    	 checkInputFields();   
	  });
	  $('#email').change(function(e) {
      	  checkInputFields()
	  });
	  $('#login').submit(function() {
		  if (!fieldCompleted)
			  return false
		  doLogin();
		  return false;
	  });
	  $("#anonymous a").click(function(e) {
        e.preventDefault();
		doLogin(true);
	  });
      $('#chat').submit(function(){
        socket.emit('chat', {
          name: username,
          message: $('#m').val()
        });
        $('#m').val('');
        return false;
      });
      socket.on('chat', function(data){
        if (data.name == null) {
          $('#messages').append($('<li>').html('<strong>' + data.message + '</strong>'));
        }
        else {
            var nickname = "Anonymous";
            if (data.name != "")
              nickname = data.name;
            $('#messages').append($('<li>').html('<span class="name">' + nickname + '</span>:&nbsp;' + data.message));
        }
      });
	  //login function
	  function doLogin(anonymous) {
		  if (!anonymous) {
		 	 username = $("#name").val();
			 email = $("#email").val();
		  }
		  socket.emit('login', {
			  name: username,
			  email: email
		  });
		  $("#loginPanel").hide();
		  $("#chatPanel").show();
	  }
	  //check input fields
	  function checkInputFields() {
		  if (
		  	$("#name").val() == "" ||
			$("#name").val() == "nickname" ||
			$("#email").val() == "" ||
			$("#email").val() == "e-mail address"
		  ) {
			  fieldCompleted = false;
		  }
		  else
		  	fieldCompleted = true;
		  setEnterEnabled();
	  }
	  
	  //set enter button enabled
	  function setEnterEnabled() {
		  if (fieldCompleted) {
			  $("#login input[type='submit']").removeClass("disabled");
		  }
		  else {
			  $("#login input[type='submit']").addClass("disabled");
		  }
	  }
    </script>
  </body>
</html>